<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Planner Client</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body {
            font-family: sans-serif ;
        }
    </style>
</head>
<body class="bg-slate-100 p-4">
    <div class="max-w-4xl mx-auto p-6 bg-white rounded-xl shadow-lg">
        <h1 class="text-3xl font-bold mb-6 text-center text-slate-800">AI Financial Planner</h1>

        <form id="financial-form" class="space-y-6">
            <!-- Main Financial Inputs -->
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <label for="monthly_net_income" class="block text-sm font-medium text-slate-700">Monthly Net Income (₹)</label>
                    <input type="number" id="monthly_net_income" name="monthly_net_income" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm" required min="0" step="0.01">
                </div>
                <div>
                    <label for="monthly_expenses" class="block text-sm font-medium text-slate-700">Monthly Expenses (₹)</label>
                    <input type="number" id="monthly_expenses" name="monthly_expenses" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm" required min="0" step="0.01">
                </div>
                <div>
                    <label for="total_assets" class="block text-sm font-medium text-slate-700">Total Assets (₹)</label>
                    <input type="number" id="total_assets" name="total_assets" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm" required min="0" step="0.01">
                </div>
                <div>
                    <label for="total_liabilities" class="block text-sm font-medium text-slate-700">Total Liabilities (₹)</label>
                    <input type="number" id="total_liabilities" name="total_liabilities" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm" required min="0" step="0.01">
                </div>
            </div>

            <!-- Additional Personal Info -->
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <label for="employment_status" class="block text-sm font-medium text-slate-700">Employment Status</label>
                    <select id="employment_status" name="employment_status" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm" required>
                        <option value="" disabled selected>Select employment status</option>
                        <option value="employed">Employed</option>
                        <option value="self-employed">Self-Employed</option>
                        <option value="student">Student</option>
                        <option value="unemployed">Unemployed</option>
                    </select>
                </div>
                <div>
                    <label for="number_of_dependents" class="block text-sm font-medium text-slate-700">Number of Dependents</label>
                    <input type="number" id="number_of_dependents" name="number_of_dependents" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm" required min="0" value="0">
                </div>
            </div>

            <!-- Goals Section -->
            <div class="space-y-4">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-semibold text-slate-800">Financial Goals</h2>
                    <button type="button" id="add-goal-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md shadow-sm hover:bg-blue-700 transition-colors">+ Add Goal</button>
                </div>
                <div id="goals-container" class="space-y-4">
                    <!-- Goal fields will be added here dynamically -->
                </div>
            </div>

            <!-- Risk Profile -->
            <div>
                <label for="risk_profile" class="block text-sm font-medium text-slate-700">Risk Profile</label>
                <select id="risk_profile" name="risk_profile" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm" required>
                    <option value="" disabled selected>Select a profile</option>
                    <option value="conservative">Conservative (6% expected returns)</option>
                    <option value="moderate">Moderate (8% expected returns)</option>
                    <option value="aggressive">Aggressive (10% expected returns)</option>
                </select>
            </div>

            <button type="submit" class="w-full p-3 bg-slate-800 text-white rounded-md shadow-lg font-bold hover:bg-slate-700 transition-colors">Generate AI Financial Plan</button>
        </form>

        <!-- Response Display Area -->
        <div id="response-container" class="mt-8 hidden">
            <!-- Response content will be inserted here -->
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('financial-form');
            const goalsContainer = document.getElementById('goals-container');
            const addGoalBtn = document.getElementById('add-goal-btn');
            const responseContainer = document.getElementById('response-container');

            let goalCounter = 0;

            const addGoalFields = () => {
                const goalDiv = document.createElement('div');
                goalDiv.className = 'goal-item p-4 border-2 border-slate-200 rounded-md space-y-3 bg-slate-50';
                goalDiv.innerHTML = `
                    <div class="flex justify-between items-center">
                        <h3 class="font-semibold text-slate-700">Goal ${goalCounter + 1}</h3>
                        <button type="button" class="remove-goal text-red-600 hover:text-red-800 font-bold">✕ Remove</button>
                    </div>
                    <div class="grid md:grid-cols-3 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-slate-700">Goal Name</label>
                            <input type="text" name="goal_name_${goalCounter}" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm" required placeholder="e.g., Emergency Fund">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700">Target Amount (₹)</label>
                            <input type="number" name="target_amount_${goalCounter}" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm" required min="0" step="0.01">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-slate-700">Target Date</label>
                            <input type="date" name="target_date_${goalCounter}" class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm" required>
                        </div>
                    </div>
                `;
                
                // Add remove functionality
                const removeBtn = goalDiv.querySelector('.remove-goal');
                removeBtn.addEventListener('click', () => {
                    goalDiv.remove();
                });
                
                goalsContainer.appendChild(goalDiv);
                goalCounter++;
            };

            // Add an initial goal field on page load
            addGoalFields();

            addGoalBtn.addEventListener('click', addGoalFields);

            form.addEventListener('submit', async (e) => {
                e.preventDefault();

                const formData = new FormData(form);
                const data = {
                    monthly_net_income: parseFloat(formData.get('monthly_net_income')),
                    monthly_expenses: parseFloat(formData.get('monthly_expenses')),
                    total_assets: parseFloat(formData.get('total_assets')),
                    total_liabilities: parseFloat(formData.get('total_liabilities')),
                    employment_status: formData.get('employment_status'),
                    number_of_dependents: parseInt(formData.get('number_of_dependents')),
                    risk_profile: formData.get('risk_profile'),
                    goals: []
                };

                // Collect dynamic goal data
                const goalItems = goalsContainer.querySelectorAll('.goal-item');
                goalItems.forEach((goalItem, index) => {
                    const goalName = goalItem.querySelector(`[name^="goal_name_"]`).value;
                    const targetAmount = parseFloat(goalItem.querySelector(`[name^="target_amount_"]`).value);
                    const targetDate = goalItem.querySelector(`[name^="target_date_"]`).value;

                    if (goalName && !isNaN(targetAmount) && targetDate) {
                        data.goals.push({
                            goal_name: goalName,
                            target_amount: targetAmount,
                            target_date: targetDate
                        });
                    }
                });
                
                try {
                    const response = await fetch('/generate-plan', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data),
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }

                    const result = await response.json();
                    sessionStorage.setItem('financialPlanResult', JSON.stringify(result));
                    window.location.href = 'result.html';

                } catch (error) {
                    alert('Error generating financial plan: ' + error.message);
                    console.error('Fetch error:', error);
                }
            });

            
        });
    </script>
</body>
</html>