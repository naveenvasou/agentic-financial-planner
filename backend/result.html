<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Planner Client</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body {
            font-family: sans-serif ;
        }
    </style>
</head>
<body class="bg-slate-100 p-4">
    <div class="max-w-4xl mx-auto p-6 bg-white rounded-xl shadow-lg">
        <h1 class="text-3xl font-bold mb-6 text-center text-slate-800">AI Financial Planner</h1>

        <!-- Back button -->
        <div class="mb-6">
            <a href="index.html" class="px-4 py-2 bg-blue-600 text-white rounded-md shadow-sm hover:bg-blue-700 transition-colors">‚Üê Back to Form</a>
        </div>

        <!-- Response Display Area -->
        <div id="response-container" class="mt-8 hidden">
            <!-- Response content will be inserted here -->
        </div>

    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const resultsDisplay = document.getElementById('results-display');
        const storedData = sessionStorage.getItem('financialPlanResult');

        if (!storedData) {
            // No data found, redirect back to form
            window.location.href = 'form.html';
            return;
        }

        // Parse the stored data
        let result;
        try {
            result = JSON.parse(storedData);
        } catch (error) {
            // Invalid data, redirect back
            window.location.href = 'form.html';
            return;
        }

        const renderResponse = (result) => {
            if (!result || !result.financial_summary || !result.goals_status || !result.ai_driven_plan) {
                responseContainer.innerHTML = '<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">Error: Invalid response format from API</div>';
                return;
            }
            
            let html = '<div class="space-y-6">';
            
            // Financial Summary Section
            html += `
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border border-blue-200">
                    <h2 class="text-2xl font-bold text-slate-800 mb-4">üìä Financial Summary</h2>
                    <div class="grid md:grid-cols-3 gap-4">
                        <div class="text-center p-4 bg-white rounded-md shadow-sm">
                            <h3 class="text-sm font-semibold text-slate-600 mb-1">Net Worth</h3>
                            <p class="text-2xl font-bold ${result.financial_summary.net_worth >= 0 ? 'text-green-600' : 'text-red-600'}">‚Çπ${result.financial_summary.net_worth.toLocaleString()}</p>
                        </div>
                        <div class="text-center p-4 bg-white rounded-md shadow-sm">
                            <h3 class="text-sm font-semibold text-slate-600 mb-1">Monthly Savings</h3>
                            <p class="text-2xl font-bold ${result.financial_summary.cashflow.monthly_savings >= 0 ? 'text-green-600' : 'text-red-600'}">‚Çπ${result.financial_summary.cashflow.monthly_savings.toLocaleString()}</p>
                        </div>
                        <div class="text-center p-4 bg-white rounded-md shadow-sm">
                            <h3 class="text-sm font-semibold text-slate-600 mb-1">Debt-to-Asset Ratio</h3>
                            <p class="text-2xl font-bold ${result.financial_summary.debt_to_asset_ratio <= 0.3 ? 'text-green-600' : result.financial_summary.debt_to_asset_ratio <= 0.5 ? 'text-yellow-600' : 'text-red-600'}">${(result.financial_summary.debt_to_asset_ratio * 100).toFixed(1)}%</p>
                        </div>
                    </div>
                </div>
            `;

            // Goals Status Section
            html += `
                <div class="bg-slate-50 p-6 rounded-lg border border-slate-200">
                    <h2 class="text-2xl font-bold text-slate-800 mb-4">üéØ Goals Status</h2>
                    <div class="space-y-4">
                        ${result.goals_status.map(goal => {
                            const statusColor = goal.on_track ? 'border-green-400 bg-green-50' : 'border-red-400 bg-red-50';
                            const statusIcon = goal.on_track ? '‚úÖ' : '‚ö†Ô∏è';
                            const statusText = goal.on_track ? 'On Track' : 'Needs Attention';
                            return `
                                <div class="p-4 rounded-md border-2 ${statusColor}">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <h3 class="font-bold text-lg text-slate-800">${statusIcon} ${goal.goal_name}</h3>
                                            <p class="text-sm text-slate-600">Target: ‚Çπ${goal.target_amount.toLocaleString()} by ${goal.target_date}</p>
                                        </div>
                                        <span class="px-3 py-1 rounded-full text-sm font-semibold ${goal.on_track ? 'bg-green-200 text-green-800' : 'bg-red-200 text-red-800'}">${statusText}</span>
                                    </div>
                                    <div class="mt-2">
                                        <p class="text-sm"><strong>Monthly Required:</strong> ‚Çπ${goal.monthly_required.toLocaleString()}</p>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;

            // AI-Driven Plan Section
            const aiPlan = result.ai_driven_plan;
            html += `
                <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-lg border border-purple-200">
                    <h2 class="text-2xl font-bold text-slate-800 mb-4">ü§ñ AI-Driven Financial Plan</h2>
                    
                    <!-- Executive Summary -->
                    <div class="mb-6 p-4 bg-white rounded-md shadow-sm">
                        <h3 class="text-lg font-semibold text-slate-800 mb-2">üìã Executive Summary</h3>
                        <p class="text-slate-700 leading-relaxed">${aiPlan.executive_summary}</p>
                    </div>

                    <!-- Quick Wins -->
                    <div class="mb-6 p-4 bg-white rounded-md shadow-sm">
                        <h3 class="text-lg font-semibold text-slate-800 mb-3">‚ö° Quick Wins</h3>
                        <ul class="space-y-2">
                            ${aiPlan.quick_wins.map(win => `<li class="flex items-start"><span class="text-green-500 mr-2">‚úì</span><span class="text-slate-700">${win}</span></li>`).join('')}
                        </ul>
                    </div>

                    <!-- Debt Repayment Plan -->
                    <div class="mb-6 p-4 bg-white rounded-md shadow-sm">
                        <h3 class="text-lg font-semibold text-slate-800 mb-3">üí≥ Debt Repayment Strategy</h3>
                        <div class="mb-3">
                            <h4 class="font-semibold text-slate-700">${aiPlan.debt_repayment_plan.strategy_name}</h4>
                            <p class="text-slate-600 mt-1">${aiPlan.debt_repayment_plan.recommendation}</p>
                        </div>
                        <div>
                            <h4 class="font-semibold text-slate-700 mb-2">Action Steps:</h4>
                            <ol class="space-y-1">
                                ${aiPlan.debt_repayment_plan.steps.map(step => `<li class="text-slate-700">${step}</li>`).join('')}
                            </ol>
                        </div>
                    </div>

                    <!-- Investment Strategy -->
                    <div class="mb-6 p-4 bg-white rounded-md shadow-sm">
                        <h3 class="text-lg font-semibold text-slate-800 mb-3">üìà Investment Strategy</h3>
                        <div class="text-slate-700 leading-relaxed whitespace-pre-line">
                            ${marked.parse(aiPlan.investment_strategy)}
                            </div>
                    </div>

                    <!-- Disclaimer -->
                    <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-md">
                        <p class="text-sm text-yellow-800"><strong>‚ö†Ô∏è Disclaimer:</strong> ${aiPlan.disclaimer}</p>
                    </div>
                </div>
            `;

            html += '</div>';
            resultsDisplay.innerHTML = html;
        };

    });
    </script>


</body>
</html>